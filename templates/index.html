{% extends "layout.html" %}

{% block title %}
    Home
{% endblock %}

{% block main %}
    <!-- TODO: Set the textareas to auto resize as the user types -->
    <div class="mb-5">
        <h1>Tailored Resume</h1>
        <p>Just copy and paste all the necessary information and get a resume tailored specifically for the job in seconds!
            For best results, ensure your resume does not have any fancy formatting or layouts. You can save your resume for
            easy access in the <a href="/account">Account</a> page.
        </p>
    </div>
    <form action="/" id="resumeForm" method="post">        
        <div class="mb-3 form-container">
            <label class="form-label" for="jobtitle">Target Job Title</label>
            <input type="text" class="form-control" id="jobtitle" name="jobtitle" placeholder="Target Job Title" required>
        </div>

        <div class="mb-3 form-container">
            <label class="form-label" for="industry">Target Job Industry</label>
            <input type="text" class="form-control" id="industry" name="industry" placeholder="Target Job Industry" required>
        </div>

        <div class="mb-3 form-container">
            <label class="form-label" for="company">Target Company</label>
            <input type="text" class="form-control" id="company" name="company" placeholder="Target Company" required>
        </div>

        <div class="mb-3 form-container">
            <label class="form-label" for="prevjob">Current/Previous Job Title</label>
            <input type="text" class="form-control" id="prevjob" name="prevjob" placeholder="Current/Previous Job Title" required>
        </div>

        <div class="mb-3">
            <label for="jobarea" class="form-label">Copy and paste the target job description below</label>
            <textarea class="form-control" id="jobarea" placeholder="Target job description" name="jobdescription" required></textarea>
        </div>

        <div class="mb-3">
            <label for="resumearea" class="form-label">Copy and paste your existing resume below</label>
            <textarea class="form-control" id="resumearea" placeholder="Existing resume" name="resume">{{ resume }}</textarea>
        </div>

        <div class="mb-3">
            <p>(This may take a few minutes)</p>
            <button class="btn btn-primary" id="submitbutton" type="submit">Submit Resume</button>
        </div>
    </form>

    <div class="container py-4" id="returnresume" hidden>
        <div id="impresp">
        </div>
    </div>
{% endblock %}

<!-- TODO: Implement AJAX to create loading efect when submit is clicked (in script) -->
{% block script %}
$(document).ready(function() {
    $('#resumeForm').submit(function(event) {
        event.preventDefault(); // Prevent the form from submitting via the browser
        var form = $(this);
        var url = form.attr('action');

        // Display loading indicator (You can customize this)
        $('#submitbutton').prop('disabled', true).text('Processing...');

        $.ajax({
            type: "POST",
            url: url,
            data: form.serialize(), // Serialize form data
            success: function(response) {
                if(response.status === 'success') {
                    // Remove the hidden attribute from #returnresume
                    $('#returnresume').removeAttr('hidden');
                    
                    // Update your page with the new content
                    $('#impresp').html(response.newContent);
                }
            },
            error: function() {
                // Handle error
                alert('An error occurred. Please try again.');
            },
            complete: function() {
                // Hide loading indicator
                $('#submitbutton').prop('disabled', false).text('Submit Resume');
            }
        });
    });
});
{% endblock %}